[["index.html", "R语言画图 第 1 章 前言 1.1 致谢", " R语言画图 唐洁 2022-09-26 第 1 章 前言 学习R作图的笔记。 1.1 致谢 感谢谢益辉开发的bookdown和模板。 "],["图形参数设置.html", "第 2 章 图形参数设置 2.1 颜色 2.2 文字 2.3 点 2.4 线", " 第 2 章 图形参数设置 2.1 颜色 2.1.1 固有颜色 colors() ## 示例1.1-1 par(family=&#39;STKaiti&#39;) plot(1:10,type=&#39;b&#39;,col=&#39;black&#39;,main=&#39;图1.1-1&#39;) ## 设置线的颜色 text(6,5,labels=&#39;文字&#39;,col=&#39;red&#39;) ## 设置文字颜色 points(2,5,col=&#39;blue&#39;) ## 设置点的颜色 ## 示例1.1-2 par(family=&#39;STKaiti&#39;) plot(1:10,type=&#39;b&#39;,col=25,main=&#39;图1.1-2&#39;) ## 设置线的颜色 text(6,5,labels=&#39;文字&#39;,col=554) points(2,5,col=28) ## pdf查看固有颜色色板 pdf(&quot;R固有颜色板.pdf&quot;,height=120) par(mar=c(0,10,3,0)+0.1,yaxs=&#39;i&#39;) barplot(rep(1,length(colors())),col=rev(colors()), names.arg=rev(colors()),horiz=T,las=1,xaxt=&#39;n&#39;, # 名称+横向+间隔+不输出横轴 main=expression(&#39;Bars of colors in&#39;~italic(colors()))) dev.off() ## quartz_off_screen ## 2 2.1.2 自助调色 ## rgb函数 Hex &lt;- rgb(red=126,green=255,blue=211,max=255) Hex ## [1] &quot;#7EFFD3&quot; ## 示例1.2-1 par(family=&#39;STKaiti&#39;) plot(1:10,type=&#39;b&#39;,col=25,main=&#39;图1.2-1&#39;) ## 设置线的颜色 text(6,5,labels=&#39;文字&#39;,col=Hex) 2.1.3 主题调色板 ## rainbow(n,s=1,v=1,start=0,end=max(1,n-1)/n,gamma=1) ## n 设定产生颜色的数目 ## start,end 设定彩虹颜色的一个子集，生成的颜色将从这个子集中选取 ## 示例1.3-1 par(family=&#39;STKaiti&#39;) barplot(rep(1,41),main=&#39;图1.3-1&#39;, col=c(rainbow(n=6,star=0, end=1/6),&quot;white&quot;, rainbow(n=6,star=1/6,end=2/6),&quot;white&quot;, rainbow(n=6,star=2/6,end=3/6),&quot;white&quot;, rainbow(n=6,star=3/6,end=4/6),&quot;white&quot;, rainbow(n=6,star=4/6,end=5/6),&quot;white&quot;, rainbow(n=6,star=5/6,end=1)) ) x.text&lt;-c(&#39;赤&#39;,&#39;黄&#39;,&#39;绿&#39;,&#39;青&#39;,&#39;蓝&#39;,&#39;紫&#39;) axis(side=1,at=seq(from=3,length.out=6,by=8.5),label=x.text,cex=0.75) ## 示例1.3-2 barplot(rep(1,56), col=c(rainbow(n=8,star=0,end=1/7), rainbow(n=8,star=1/7,end=2/7), rainbow(n=8,star=2/7,end=3/7), rainbow(n=8,star=3/7,end=4/7), rainbow(n=8,star=4/7,end=5/7), rainbow(n=8,star=5/7,end=6/7), rainbow(n=8,star=6/7,end=1) ) ) 2.1.4 其他主题配色函数 ## heat.colors() terrain.colors() topo.colors() cm.colors() ## 示例1.4-1 barplot(rep(1,6),col=heat.colors(6),main=&#39;heat.colors&#39;) barplot(rep(1,6),col=terrain.colors(6),main=&#39;terrain.colors&#39;) barplot(rep(1,6),col=topo.colors(6),main=&#39;topo.colors&#39;) barplot(rep(1,6),col=cm.colors(6),main=&#39;cm.colors&#39;) 2.1.5 颜色扩展包 ## RColorBrewer包 brewer.pal() ## 连续Sequential 两极Diverging 离散Qualitative ## 示例1.5-1 ## RColorBrewerl连续型渐变色 library(RColorBrewer) display.brewer.all(type=&#39;seq&#39;) # 18组 9个渐变颜色 ## 示例1.5-2 RColorBrewerl极端型渐变色 library(RColorBrewer) display.brewer.all(type=&#39;div&#39;) # 9组 11个颜色 ## 示例1.5-3 RColorBrewerl离散型渐变色 library(RColorBrewer) display.brewer.all(type=&#39;qual&#39;) # 8组 ## 示例1.5-4 library(RColorBrewer) ## 使用YlOrRd组的第3～8种颜色 barplot(rep(1,6),col=brewer.pal(9,&#39;YlOrRd&#39;)[3:8],main=&#39;1.5-4&#39;) ## 使用BrBG组的第3～8种颜色 barplot(rep(1,6),col=brewer.pal(11,&#39;BrBG&#39;)[3:8],main=&#39;1.5-4&#39;) 2.2 文字 ## text(font,cex,col,...) 2.2.1 字体 ## 示例2.1-1 par(family=&#39;STKaiti&#39;) plot(c(1:6),col=&#39;white&#39;,main=&#39;图2.1-1&#39;) text(2,2,labels=&#39;font=1: 正常字体(默认)&#39;,font=1) text(3,3,labels=&#39;font=2: 粗体字体&#39;,font=2) text(4,4,labels=&#39;font=3: 斜体字体&#39;,font=3) text(5,5,labels=&#39;font=4: 粗斜体字体&#39;,font=4) ## 示例2.1-2 # par(family=&#39;HersheySerif&#39;) par(family=&#39;STKaiti&#39;) plot(c(1:6),col=&#39;white&#39;,main=&#39;图2.1-2&#39;) text(2,2,labels=&#39;font=1&#39;,font=1) text(3,3,labels=&#39;font=2&#39;,font=2) text(4,4,labels=&#39;font=3&#39;,font=3) text(5,5,labels=&#39;font=4&#39;,font=4) 2.2.2 大小 ## 示例2.2-1 par(family=&#39;STKaiti&#39;) plot(c(1:7),col=&#39;white&#39;,main=&#39;图2.2-1&#39;) text(2,2,labels=&#39;cex=0.5&#39;,cex=0.5) text(3,3,labels=&#39;cex=0.8&#39;,cex=0.8) text(4,4,labels=&#39;cex=1&#39;,cex=1) text(5,5,labels=&#39;cex=1.2&#39;,cex=1.2) text(6,6,labels=&#39;cex=1.5&#39;,cex=1.5) 2.3 点 ## points(pch,col,cex,...) pch 数字取点的样式 par(family=&#39;STKaiti&#39;) plot(1,col=&#39;white&#39;,xlim=c(0.5,6.5),ylim=c(1,7),main=&#39;图3.1 R点样式&#39;) for(i in c(0:25)){ x &lt;- (i%/%5)*1+1 y &lt;- 6-(i%%5) if(length(which(c(21:25)==i)&gt;=1)){ points(x,y,pch=i,bg=&#39;blue&#39;,cex=2) #21-25可设置背景样式 }else{ points(x,y,pch=i,cex=2) } text(x+0.22,y+0.22,labels=i) } pch 字符取点的样式,如 * . O o + - 0-9 | par(family=&#39;STKaiti&#39;) plot(1,col=&#39;white&#39;,xlim=c(0.5,6.5),ylim=c(1,7),main=&#39;图3.2 字符取点的样式&#39;) for(i in c(0:25)){ x &lt;- (i%/%5)*1+1 y &lt;- 6-(i%%5) if(length(which(c(21:25)==i)&gt;=1)){ points(x,y,pch=i,bg=&#39;blue&#39;,cex=2) #21-25可设置背景样式 }else{ points(x,y,pch=i,cex=2) } text(x+0.22,y+0.22,labels=i) } points(6,5,pch=&#39;*&#39;,cex=2,main=&#39;图3.2&#39;) text(6+0.22,5+0.22,labels=&#39;*&#39;) 2.4 线 ## lines(lty,lwd,col,...) ## plot(type默认为点,l为线) lty 线条样式 par(family=&#39;STKaiti&#39;) data = matrix(rep(rep(1:7),10),nrow=7,ncol=10) plot(data[1,],type=&#39;l&#39;,lty=0,ylim=c(0,8),xlim=c(-1,10),axes=F,main=&#39;图4 lty 线样式&#39;) text(0,1,labels=&#39;lty=0&#39;) for(i in c(2:7)){ lines(data[i,],lty=i-1) text(0,i,labels=paste(&#39;lty=&#39;,i-1)) } ## lwd 线条宽度 lty默认为1，实线 par(family=&#39;STKaiti&#39;) data = matrix(rep(rep(1:7),10),nrow=7,ncol=10) plot(data[1,],type=&#39;l&#39;,lwd=0.5,ylim=c(0,9),xlim=c(-1,10),axes=F,main=&#39;图4 lwd 线条宽度&#39;) text(0,1,labels=&#39;lwd=0.5&#39;) for(i in c(2:7)){ lines(data[i,],lwd=i*0.5) text(0,i,labels=paste(&#39;lwd=&#39;,i*0.5)) } "],["低级绘图函数.html", "第 3 章 低级绘图函数 3.1 标题 3.2 图例 3.3 坐标轴 3.4 网格线 3.5 点 3.6 线", " 第 3 章 低级绘图函数 3.1 标题 ## title(main,sub,xlab,ylab) ## mian=&#39;内容&#39; 或者 main=list(&#39;&#39;,font,col,cex) ## 示例5-1 data = data.frame(pre=c(113,134,123,145,137,196,187), now=c(129,122,134,149,146,215,208)) col=c(&#39;azure4&#39;,&#39;brown4&#39;) par(family=&#39;STKaiti&#39;) barplot(as.matrix(rbind(data$pre,data$now)), beside=TRUE,col=col,axes=F) axis(2) ## 添加主标题、副标题、主轴标题 data = data.frame(pre=c(113,134,123,145,137,196,187), now=c(129,122,134,149,146,215,208)) col=c(&#39;azure4&#39;,&#39;brown4&#39;) par(family=&#39;STKaiti&#39;) barplot(as.matrix(rbind(data$pre,data$now)), beside=TRUE,col=col,axes=F) axis(2) title(main=list(&#39;图5-1 本周pv趋势分析图&#39;,cex=1.5,col=&#39;red&#39;,font=3), sub=&#39;数据来源：某电商网站&#39;, ylab=&#39;网站日页面浏览量pv&#39;) ## 示例5-2 data = data.frame(pre=c(113,134,123,145,137,196,187), now=c(129,122,134,149,146,215,208)) col=c(&#39;azure4&#39;,&#39;brown4&#39;) par(family=&#39;STKaiti&#39;) barplot(as.matrix(rbind(data$pre,data$now)), beside=TRUE,col=col,axes=T, main=list(&#39;图5-2 本周pv趋势分析图&#39;,cex=1.5,col=&#39;red&#39;,font=3), sub=&#39;数据来源：某电商网站&#39;, ylab=&#39;网站日页面浏览量pv&#39;) 3.2 图例 ## legend(x,y,legend,horiz,ncol,pch,lty,col,bg,bty,title) ## x,y 图例位置，或 center、left、right、top、bottom、bottomright、bottomleft、topleft、topright ## legend 字符向量表示图例文字 ## horiz FALSE(默认)图例垂直排列、反之水平 ## ncol 图例的列数目；horiz=TRUE无意义 ## pch 图例中的点样式；NA无点样式 ## lty 图例中的线样式；NA无线样式 ## col 图例中点/线的颜色 ## bg 图例的背景颜色；为n时无效 ## bty 图例框的样式；为n时无边框；为o时显示边框 ## title 图例的标题 ## 示例6-1 data = data.frame(pre=c(113,134,123,145,137,196,187), now=c(129,122,134,149,146,215,208)) col=c(&#39;azure4&#39;,&#39;brown4&#39;) par(family=&#39;STKaiti&#39;) barplot(as.matrix(rbind(data$pre,data$now)), beside=TRUE,col=col,axes=T, main=list(&#39;图6-1&#39;,cex=1.5,col=&#39;red&#39;,font=3), sub=&#39;数据来源：某电商网站&#39;, ylab=&#39;网站日页面浏览量pv&#39;) text.legend = c(&#39;上周pv&#39;,&#39;本周pv&#39;) legend(&#39;topleft&#39;,pch=c(15,15),legend=text.legend, col=col,bty=&#39;n&#39;,horiz=TRUE) ## 示例6-2 par(family=&#39;STKaiti&#39;) barplot(as.matrix(rbind(data$pre,data$now)), beside=TRUE,col=col,axes=T, main=list(&#39;图6-2&#39;,cex=1.5,col=&#39;red&#39;,font=3), sub=&#39;数据来源：某电商网站&#39;, ylab=&#39;网站日页面浏览量pv&#39;) legend(&#39;top&#39;,pch=c(15,15),legend=text.legend, col=col,bty=&#39;o&#39;,horiz=FALSE) ## 示例6-3 par(family=&#39;STKaiti&#39;) barplot(as.matrix(rbind(data$pre,data$now)), beside=TRUE,col=col,axes=T, main=list(&#39;图6-3&#39;,cex=1.5,col=&#39;red&#39;,font=3), sub=&#39;数据来源：某电商网站&#39;, ylab=&#39;网站日页面浏览量pv&#39;, legend.text=text.legend) 3.3 坐标轴 ## 低级绘图 ## axis(side,labels,front.axis,cex.axis,cool.axis,at,tick,col,col.ticks,) ## side 取1、2、3、4对应下、左、上、右 ## labels 通过向量来设置坐标轴内各刻度的名称（刻度标记） ## font.axis 刻度标记的字体 ## cex.axis 刻度标记的大小 ## at 通过向量来设置坐标轴内各刻度标记的位置，at参数向量与labels参数向量一一对应 ## tick 逻辑参数，TRUE画出坐标轴，反之不画，FALSE不影响labels展示 ## col 坐标轴的颜色，tick=TRUE时有效，除了刻度标记(labels)以外的部分颜色，包括col.ticks ## col.ticks 坐标轴刻度线的颜色，即与坐标轴垂直的小刻度线的颜色 ## lty 坐标轴的样式，tick=TRUE时有效 ## lwd 坐标轴的宽度，tick=TRUE时有效 ## 示例7-1 data = data.frame(pre=c(113,134,123,145,137,196,187), now=c(129,122,134,149,146,215,208)) col=c(&#39;azure4&#39;,&#39;brown4&#39;) par(family=&#39;STKaiti&#39;) barplot(as.matrix(rbind(data$pre,data$now)), beside=TRUE,col=col,axes=T, main=list(&#39;图7-1&#39;,cex=1.5,col=&#39;red&#39;,font=3), sub=&#39;数据来源：某电商网站&#39;, ylab=&#39;网站日页面浏览量pv&#39;, legend.text=c(&#39;上周pv&#39;,&#39;本周pv&#39;)) text.x=c(&#39;周一&#39;,&#39;周二&#39;,&#39;周三&#39;,&#39;周四&#39;,&#39;周五&#39;,&#39;周六&#39;,&#39;周日&#39;) axis(1,at=c(2,5,8,11,14,17,20), labels=text.x, tick=FALSE, cex.axis=0.75) ## 示例7-2 par(family=&#39;STKaiti&#39;) plot(1:7,rnorm(7),main=&#39;图7-2&#39;, type=&#39;s&#39;,xaxt=&#39;n&#39;,frame=F,col=&#39;red&#39;) axis(1,at=1:7,labels=LETTERS[1:7],col.axis=&#39;blue&#39;) axis(3,col=&#39;gold&#39;,lty=2,lwd=1.5) axis(4,col=&#39;violet&#39;,col.axis=&#39;dark violet&#39;, lwd=2) ## 高级绘图 plot ## 设置坐标轴的展示和范围axes、xlim、ylim ## axes T(默认)显示x、y轴;F隐藏 ## xaxt 坐标轴样式&#39;s&#39;(默认)标准样式显示;&#39;n&#39;隐藏x轴 ## yaxt 同上 ## xaxs 轴的计算方式,&#39;r&#39;(默认)先把原始数据的范围向外扩大4%,&#39;l&#39;直接使用原始数据范围 ## yaxs 同上 ## xlog 设置x轴坐标是否取对数,F(默认) ## ylog 同上 ## xlim x轴的范围,c(from,to),from是x轴的首坐标,to是尾坐标 ## ylim 同上 ## 注意: ## 同时隐藏x、y轴,则设置axes=F ## 隐藏x轴只显示y轴,则设置xaxt=&#39;n&#39;或者设置axes=F之后使用axis(2) ## 示例7-3 par(family=&#39;STKaiti&#39;) plot(1:7,rnorm(7),main=&#39;图7-3&#39;,type=&#39;s&#39;, axes=T,frame=F,col=&#39;red&#39;, xaxt=&#39;s&#39;) ## 示例7-4 par(family=&#39;STKaiti&#39;) lx &lt;- seq(1, 5, length.out = 41) yl &lt;- expression(e^{-frac(1,2) * {log[10](x)}^2}) y &lt;- exp(-.5*lx^2) op &lt;- par(mfrow = c(2,1), mar = par(&quot;mar&quot;)-c(1,0,2,0), mgp = c(2, .7, 0)) plot(10^lx, y, log = &quot;xy&quot;, type = &quot;l&quot;, col = &quot;purple&quot;, main = &quot;7-4 Log-Log plot&quot;, ylab = yl, xlab = &quot;x&quot;) plot(10^lx, y, log = &quot;xy&quot;, type = &quot;o&quot;, pch = &quot;.&quot;, col = &quot;forestgreen&quot;, main = &quot;7-4 Log-Log plot with custom axes&quot;, ylab = yl, xlab = &quot;x&quot;, axes = FALSE, frame.plot = TRUE) my.at &lt;- 10^(1:5) axis(1, at = my.at, labels = formatC(my.at, format = &quot;fg&quot;)) e.y &lt;- -5:-1 ; at.y &lt;- 10^e.y axis(2, at = at.y, col.axis = &quot;red&quot;, las = 1, labels = as.expression(lapply(e.y, function(E) bquote(10^.(E))))) ## 坐标轴的密度分布表示 library(ggplot2) par(family=&#39;STKaiti&#39;) diamonds1 = diamonds[sample(1:nrow(diamonds),1000),] attach(diamonds1) plot(carat,price,main=&#39;图7-5&#39;) rug(carat) rug(price,side=2) detach(diamonds1) 3.4 网格线 ## grid(ny,nx) ## ny 设置水平网格的数目 NA不绘制相应的网格线 ## nx 设置垂直网格的数量 NA不绘制相应的网格线 ## 示例8-1 x.text = paste(seq(1,12,1),&#39;月&#39;) sales.volume = c(158721,190094,108441,88092,68709,50116,90117,16004,186045,106334,89092,104933) par(family=&#39;STKaiti&#39;) plot(sales.volume,type=&#39;b&#39;,ylim=c(20000,250000),axes = F, frame.plot = TRUE,main=&#39;图8-1 月销量趋势图&#39;, xlab=&#39;月份&#39;,ylab=&#39;销量(元)&#39;) axis(1,at=1:12,labels=x.text,tick=F) axis(2, at = seq(50000,250000,50000), las = 1) grid(nx=NA,ny=8,lwd=1,lty=2) ## 示例8-2 par(family=&#39;STKaiti&#39;) plot(sales.volume,type=&#39;b&#39;,ylim=c(20000,250000),xaxt=&#39;n&#39;, main=&#39;图8-2 月销量趋势图&#39;,xlab=&#39;月份&#39;,ylab=&#39;销量(元)&#39;) axis(1,at=1:12,labels=x.text,tick=F) grid(nx=NULL,ny=NULL,col=&#39;lightgray&#39;, lty=&#39;dotted&#39;,lwd=par(&#39;lwd&#39;),equilogs=T) 3.5 点 ## x,y 横纵坐标位置，可以是向量表示多个点的位置 ## type 9种样式; p l b c o h s S n ## pch 点样式 ## col 点颜色 ## bg 点背景色 pch取21～25时有效 ## lwd 点的边线的宽度 ## cex 点的大小 ## 示例9.1 x = 2:9 y = 2:9 op &lt;- par(mfrow = c(3,3), mar = .1+ c(2,2,3,1)) for(tp in c(&quot;p&quot;,&quot;l&quot;,&quot;b&quot;,&quot;c&quot;,&quot;o&quot;,&quot;h&quot;,&quot;s&quot;,&quot;S&quot;,&quot;n&quot;)){ plot(1,ylim=c(1,10),xlim=c(1,10),col=&#39;white&#39;,type = tp, main = paste0(&quot;9.1 points(*, type = \\&quot;&quot;, tp, &quot;\\&quot;)&quot;)) points(x,y,type=tp) if(tp == &quot;S&quot;) { points(x, y, type = &quot;s&quot;, col = &quot;red&quot;, lty = 2) mtext(&quot;points(*, type = \\&quot;s\\&quot;, ...)&quot;, col = &quot;red&quot;, cex = 0.8) } } 3.6 线 ## 直线abline 、曲线lines 、线段segments ## abline ## a、b 截距、斜率 abline(a,b) ## h 水平线 abline(h=y) ## v 垂直线 abline(v=x) ## coef 提取系数的R对象 abline(lm.obj) ## abline ## 示例9.2-1 sol.lm = lm(iris[,1]~iris[,3]) par(family=&#39;STKaiti&#39;) plot(iris[,1]~iris[,3],col=&#39;blue&#39;,main=&#39;图9.2-1&#39;) abline(sol.lm,col=&#39;red&#39;) ## lines ## 示例9.2-2 x &lt;- 0:12 y &lt;- sin(pi/5 * x) op &lt;- par(mfrow = c(3,3), mar = .1+ c(2,2,3,1)) for (tp in c(&quot;p&quot;,&quot;l&quot;,&quot;b&quot;,&quot;c&quot;,&quot;o&quot;,&quot;h&quot;,&quot;s&quot;,&quot;S&quot;,&quot;n&quot;)) { plot(y ~ x, type = tp, main = paste0(&quot;9.2-2 plot(*, type = \\&quot;&quot;, tp, &quot;\\&quot;)&quot;)) if(tp == &quot;S&quot;) { lines(x, y, type = &quot;s&quot;, col = &quot;red&quot;, lty = 2) mtext(&quot;lines(*, type = \\&quot;s\\&quot;, ...)&quot;, col = &quot;red&quot;, cex = 0.8) } } ## 示例9.2-3 par(family=&#39;STKaiti&#39;) plot(cars,main=&#39;图9.2-3 Stopping Distance versus Speed&#39;) lines(stats::lowess(cars)) "],["高级绘图函数.html", "第 4 章 高级绘图函数 4.1 饼图", " 第 4 章 高级绘图函数 4.1 饼图 par(family=&#39;STKaiti&#39;) barplot(c(26,30,14,35),axes = FALSE, main=list(&#39;标题&#39;,cex=1.5,col=&#39;black&#39;,font=3), col=c(&quot;#56B4E9&quot;,&quot;#FFC90E&quot;,&quot;#ED1C24&quot;,&quot;#22B14C&quot;), names.arg=c(&#39;A&#39;,&#39;B&#39;,&#39;C&#39;,&#39;D&#39;), sub=&#39;副标题&#39;, ylab=&#39;人数&#39; ) axis(2, at = seq(0,35,5), las = 1) # 数据准备 info = c(10,12, 3, 1) names = c(&quot;A&quot;,&quot;B&quot;, &quot;C&quot;, &quot;D&quot;) cols = c(&quot;#56B4E9&quot;,&quot;#FFC90E&quot;,&quot;#ED1C24&quot;,&quot;#22B14C&quot;) # 计算百分比 piepercent = paste(round(100*info/sum(info)), &quot;%&quot;) # 绘图 pie(info, labels=piepercent, main = &quot;标题&quot;, col=cols) # 添加颜色样本标注 legend(&quot;topleft&quot;, names, cex=0.8, fill=cols) info = c(11,10,5,1,3) names = c(&quot;A&quot;,&#39;B&#39;,&quot;C&quot;, &quot;D&quot;, &quot;E&quot;) cols = c(&quot;#56B4E9&quot;,&quot;#FFC90E&quot;,&quot;#ED1C24&quot;,&quot;#22B14C&quot;,&quot;#3f48CC&quot;) # 计算百分比 piepercent = paste(round(100*info/sum(info)), &quot;%&quot;) # 绘图 pie(info, labels=piepercent, main = &quot;标题&quot;, col=cols) # 添加颜色样本标注 legend(&quot;topleft&quot;, names, cex=0.8, fill=cols) "],["qq图.html", "第 5 章 QQ图 5.1 绘制QQ图 5.2 一个例子 5.3 参考资料", " 第 5 章 QQ图 5.1 绘制QQ图 5.1.1 R包绘制 基础包qqnorm和qqline函数 R包car 5.1.2 手工绘制 基础工具plot绘制 par(mfrow=c(1,2)) plot(seq(-3,3,0.01), dnorm(seq(-3,3,0.01)), xlab = &#39;x&#39;, ylab = &#39;f(x)&#39;, ylim = c(0,0.5), xaxs = &#39;i&#39;, yaxs = &#39;i&#39;, type = &#39;l&#39;) plot(qnorm(seq(0,1,0.001)), seq(0,1,0.001), xlab = &#39;x&#39;, ylab = &#39;F(x)&#39;, xaxs = &#39;i&#39;, yaxs = &#39;i&#39;, type = &#39;l&#39;) x = seq(-3,3,0.01) par(mfrow=c(1,1)) plot(x,x, main = &#39;Q-Q figure&#39;, xlim = c(-3,3), ylim = c(-3,3), xlab = &#39;Theoretical quantile&#39;, ylab = &#39;Sample quantile&#39;, xaxs = &#39;i&#39;, yaxs = &#39;i&#39;, type = &#39;l&#39;) n = 200 x = seq(-3,3,0.01) par(mfrow=c(1,1)) plot(x,x, xlim = c(-3,3), ylim = c(-3,3), xaxs = &#39;i&#39;, yaxs = &#39;i&#39;, yaxt = &#39;n&#39;, ann = F, type = &#39;l&#39;) axis(2, las = 1) title(main = paste0(&#39;Normal n = &#39;,n), xlab= &#39;Normal quantile&#39;, ylab = &#39;EL quantile&#39;, line = 2) 5.2 一个例子 5.2.1 了解分位数。 # 生成一组数字，作为示例数据 set.seed(6666) dat = sample(1:1000,15) dat # 这些数据画在图上,横坐标没有意义,纵坐标代表dat的数值。 library(ggplot2) p = ggplot(dat = as.data.frame(dat),aes(x = factor(1),y = dat))+ geom_point(aes(color = factor(dat),fill = factor(dat)), size = 3.5,shape = 21,alpha = 0.5)+ labs(x = &quot;&quot;)+ theme_bw()+ theme(legend.position = &quot;none&quot;) p # 四分位数，即可以将这组数据分成等量的四个部分的三个数。 quantile(dat) ## 0% 25% 50% 75% 100% ## 111 333 520 701 993 # 三条线分别代表25% 50% 75% 的四分位数，与箱线图异曲同工。 p + geom_hline(yintercept = quantile(dat)[2:4],linetype = 4) # 四分位数是最常见的，在此基础上可以扩展到百分位数，例如： qk = quantile(dat,probs = seq(0, 1, length.out = 15)) qk ## 0% 7.142857% 14.28571% 21.42857% 28.57143% 35.71429% 42.85714% 50% ## 111 285 289 328 338 350 462 520 ## 57.14286% 64.28571% 71.42857% 78.57143% 85.71429% 92.85714% 100% ## 558 611 612 790 847 926 993 # 这是15个数字，所以分成了15份 p + geom_hline(yintercept = qk,linetype = 2) 5.2.2 数据准备 # 生成符合三种分布的数据，作为检验示例数据属于那种分布的参考。任何一个分布都可以。 library(patchwork) df = data.frame(x = 1:100, normal = dnorm(1:100,50,15), uniform = dunif(1:100,1,100), exponential = dexp(1:100,0.06)) head(df) set.seed(1004);normal = rnorm(100,50,15) set.seed(1004);uniform = 1:100 set.seed(1004);exponential = rexp(100,0.06) rn = data.frame(x = 1:100, normal = normal, uniform = uniform , exponential = exponential ) head(rn) ## x normal uniform exponential ## 1 1 0.0001281199 0.01010101 0.05650587 ## 2 2 0.0001589392 0.01010101 0.05321523 ## 3 3 0.0001962978 0.01010101 0.05011621 ## 4 4 0.0002413624 0.01010101 0.04719767 ## 5 5 0.0002954566 0.01010101 0.04444909 ## 6 6 0.0003600704 0.01010101 0.04186058 ## x normal uniform exponential ## 1 1 40.88239 1 12.995556 ## 2 2 61.51444 2 28.127434 ## 3 3 47.53592 3 4.341248 ## 4 4 49.56835 4 0.180288 ## 5 5 50.20337 5 14.291344 ## 6 6 39.26425 6 36.579238 两个数据框，一个是符合某分布的某个数值大小的概率，一个是符合某分布的具体数值，两个数据框的二三四列分别是正态分布、均匀分布和指数分布。理解qq图可以帮助我们探索数据属于哪种分布。 5.2.3 三种分布的密度图 #1.正态分布 p1 = ggplot(df,aes(x = x,y = normal ))+ geom_line()+theme_classic() #2.均匀分布 p2 = ggplot(df,aes(x = x,y = uniform ))+ geom_line()+theme_classic() #3.指数分布 p3 = ggplot(df,aes(x = x,y = exponential ))+ geom_line()+theme_classic() p1+p2+p3 5.2.4 画出15个分位数 qn = apply(rn,2,function(x){ quantile(x,probs = seq(0, 1, length.out = 15)) }) qn[,1] = 1:nrow(qn) qn = data.frame(qn) qp = function(p,nc){ a = p n = c() for(i in 1:nrow(qn)){ n[[i]] = qn[i,nc] a = a + geom_vline(xintercept = n[[i]],color = &quot;red&quot;,size = 0.3,alpha = 0.3) } return(a) } qp(p1,2)+qp(p2,3)+qp(p3,4) 5.2.5 绘制qq图 # 15个数据实在太少，比较不同分布时不够明显，所以扩展到100个。 dat = sample(1:1000,100) qn$nk = quantile(dat,probs = seq(0, 1, length.out = 15)) qq = function(k){ ggplot(data = qn,aes_string(x = colnames(qn)[k],y = &quot;nk&quot;))+ geom_point()+ geom_smooth(method = &quot;lm&quot;,se = F)+ theme_bw() } qq(2)+qq(3)+qq(4) 上面画参考线的方法直接按照线性拟合来画了。qqline函数是将上下四分位数连线作为参考线的。 哪种分布作为横坐标画出的qq图更接近一条直线，数据就更接近哪种分布。 5.2.6 函数绘制正态qq图 基础包函数qqnorm和qqline，横坐标是标准正态分布的分位数，纵坐标是输入数据的分位数，也就是检验数据是否符合正态分布 qqnorm(qn$nk) qqline(qn$nk, col=2) R包car来绘制 library(car) qqPlot(qn$nk) ## [1] 1 15 5.3 参考资料 网站：简书。QQ图的理解和绘制 网站：CNSD。qq图 Lane, D.M. eBook。Introduction to Statistics "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
